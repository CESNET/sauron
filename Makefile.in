#########################################################################
# $Id$ 
# 
# Makefile for sauron
#
Version = 0.1
PKGNAME = sauron

DBASE = sauron

SHELL = /bin/sh

DEFS = @DEFS@

srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@

# Where to install the executables.
bindir = $(exec_prefix)/bin

# Where to put libraries
libdir = $(prefix)/lib

# Where to put the Info files
infodir = $(prefix)/info

# Where to put the manual pages.
mandir = $(prefix)/man


RUNSQL = $(srcdir)/runsql



CC        = @CC@ 
XCPPFLAGS = @CPPFLAGS@
CFLAGS    = @CFLAGS@ $(XCPPFLAGS) $(DEFS)
LDFLAGS   = @LDFLAGS@
LIBS      = @LIBS@
STRIP     = strip


INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

@SET_MAKE@

# there should be no reason to modify lines below this
#########################################################################

SQL_TABLES = 	sql/common.sql \
		sql/cidr_entries.sql sql/dhcp_entries.sql sql/ether_info.sql \
		sql/groups.sql sql/host_info.sql sql/hosts.sql \
		sql/mx_entries.sql sql/mx_templates.sql \
		sql/nets.sql sql/ns_entries.sql \
		sql/printer_classes.sql sql/printer_entries.sql \
		sql/rr_a.sql sql/servers.sql sql/txt_entries.sql \
	        sql/user_rights.sql sql/users.sql \
		sql/wks_entries.sql sql/wks_templates.sql \
		sql/zones.sql sql/utmp.sql sql/hinfo_templates.sql \
		sql/arec_entries.sql 


DIRNAME = $(shell basename `pwd`) 
DISTNAME  = $(PKGNAME)-$(Version)
BACKUPNAME = $(PKGNAME)-`date +%b%d`

BINARIES = parse-hosts-rows
OBJS = 

.c.o:	
	$(CC) $(CFLAGS) $(OPTIONS) -c -o $*.o $<


all:	$(PKGNAME) 

$(PKGNAME):  $(BINARIES)
	@echo "All done"

parse-hosts-rows:  parse-hosts-rows.c
	$(CC) $(CFLAGS) -o parse-hosts-rows parse-hosts-rows.c $(LDFLAGS) $(LIBS) 


strip:
	for i in $(PKGNAME) ; do [ -x $$i ] && $(STRIP) $$i ; done

clean:
	rm -f *~ *.o core a.out make.log \#*\# $(OBJS) $(BINARIES)

clean_all: clean
	rm -f Makefile config.h config.log config.cache config.status

clean_tables:
	$(RUNSQL) -v -n sql/drop_tables.sql
	@echo "Database cleaned..."

init_tables: 
	$(RUNSQL) $(SQL_TABLES)
	@echo "Database initialized..."

grant_full:
	perl -e 'while (<>) { s/:user:/tjko/g; print; }' init/full-privileges.sql | psql sauron

dist:	clean
	(cd .. ; tar cvzf $(DISTNAME).tar.gz $(DIRNAME))

backup:	clean
	(cd .. ; tar cvzf $(BACKUPNAME).tar.gz $(DIRNAME))



install: all  install.man
	$(INSTALL) -m 755 $(PKGNAME) $(bindir)/$(PKGNAME)

printable.man:
	groff -Tps -mandoc ./$(PKGNAME).1 >$(PKGNAME).ps
	groff -Tascii -mandoc ./$(PKGNAME).1 | tee $(PKGNAME).prn | sed 's/.//g' >$(PKGNAME).txt

install.man:
	$(INSTALL) -m 644 $(PKGNAME).1 $(mandir)/man1/$(PKGNAME).1



# a tradition !
love:	
	@echo "Not War - Eh?"
# eof

