<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook V4.0//EN" [
<!ENTITY sauron-logo SYSTEM "sauron_tower_bare.eps" NDATA EPS>
<!ENTITY overview-pic SYSTEM "overview.eps" NDATA EPS>
<!ENTITY relations-pic SYSTEM "relations.eps" NDATA EPS>
<!ENTITY gpl SYSTEM "gpl.sgml">
<!ENTITY sql-tables SYSTEM "tables.sgml">
]>



<book id="sauron-manual">

  <bookinfo>
    <title>GNU/Sauron: User's Guide</>
    <subtitle>Version 0.5</>
    <date>$Date$</>
    <authorgroup>
      <author>
	<firstname>Timo</>
	<surname>Kokkonen</>
      </author>
    </authorgroup>
    <copyright>
      <year>2003</>
      <holder>Timo Kokkonen</>
    </copyright>
    <legalnotice>
      <para>
	This software and manual are distributed under the 
	GNU General Public License.
      </para>
    </legalnotice>
  </bookinfo>

  <preface>
    <title>Preface</>
    <para>
      This manual describes the GNU/Sauron, a free DNS &amp; DHCP management
      system. 
    </para>

    <section id="copyright">
      <title>Copyright Notice</>
      <para>
	Sauron is Copyright (C) 1999-2003 Timo Kokkonen and others.
      </para>
      <para>
	This  program  is  free  software; you can redistribute it
	and/or modify it under the terms of the GNU General Public
	License  as  published  by  the  Free Software Foundation;
	either version 2 of the License, or (at your  option)  any
	later version.
      </para>
      <para>
	This  program  is distributed in the hope that it will be
	useful, but WITHOUT ANY WARRANTY; without even the implied
	warranty  of  MERCHANTABILITY  or FITNESS FOR A PARTICULAR
	PURPOSE.  See the GNU  General  Public  License  for  more
	details.
      </para>
      <para>
	You should have received a copy of the GNU General Public
	License along with this program; if not, write to the Free
	Software  Foundation,  Inc.,  675  Mass Ave, Cambridge, MA
	02139, USA.
      </para>
    </section>

  </preface>

  <toc>
  </toc>


  <chapter id="intro-chapter">
    <title>Introduction</>
    <para>
      Sauron is a scalable system for management of DNS and DHCP services.
      Sauron can dynamically generate complete DNS and DHCP configurations
      from a central SQL-database. Automatic generation of DNS 
      <quote>reverse</> zones (with support for smaller than C-class
      reverse delegations) is supported. Sauron comes with web interface
      and command-line interface. The web interface comes 
      with user/group based access controls for distributed management.
    </para>

    <section>
      <title>History of Sauron</>
      <para>
        Sauron was originally designed and written by Timo Kokkonen 
        at the Computing Center of University of Jyvaskyla. 
        In 1999, when work on Sauron was started, it was meant to provide 
        a simple web based interface for letting multiple users 
        simultaneously manage DNS zone files, but it has since
        grown into a full featured DNS & DHCP management software.
      </para>
      <para>
        Sauron is still under development, but it has been in production 
        use since early 2001, managing the campus area network (CAN) with 
        over 10,000 computers at University of Jyvaskyla, Finland.
      </para>
    </section>

    <section>
      <title>System Overview</>
      <para>
        Sauron is bult around sauron <quote>back-end</> that is used by the
        command-line and web interfaces to access the data stored in a
        SQL-database (PostgreSQL). Sauron is able to dynamically generate
        complete DNS (ISC BIND) and DHCP (ISC DHCP) configurations based
        on the data stored in the SQL-databse. Sauron is currently written
        almost completely in Perl using only standard perl modules and
        couple of additional modules from CPAN. Web interface is standalone
        CGI script and should work with almost any www server that supports
        CGI.
      </para>
      <figure><title>System Overview</title>
	<graphic scale=75 fileref="overview.eps">
      </figure>
      <para>
        
      </para>
      <section>
      <title>Features</>
      <para>
      Some of the main features of Sauron include:
      <itemizedlist>
       <listitem><para>
        generates complete BIND (DNS) configuration file set for 
        each server
       </para></listitem>
       <listitem><para>
        generates complete dhcpd (ISC's DHCP) configuration file set for
        each server
       </para></listitem>
       <listitem><para>
        automatically generates DNS <quote>reverse</> zones
       </para></listitem>
       <listitem><para>
        supports smaller than class-C <quote>reverse</> zone delegations
       </para></listitem>
       <listitem><para>
        dynamic host aliases (both CNAME and A record)
       </para></listitem>
       <listitem><para>
        support for dynamic DHCP address pools with access controls
        (requires DHCP v3)
       </para></listitem>
       <listitem><para>
         DHCP failover support (requires DHCP v3)
       </para></listitem>
       <listitem><para>
         MX and WKS record templates for hosts
       </para></listitem>
       <listitem><para>
         groups; hosts may be assigned into a group that defines common
         attributes for it
       </para></listitem>
       <listitem><para>
         support for most of the standard DNS RRs (resource records)
       </para></listitem>
       <listitem><para>
         support for automatic validation of generated DNS and DHCP
         configuration file sets
       </para></listitem>
      </itemizedlist>
      </para>
      </section>
    </section>


    <section>
      <title>Sauron Home Page</>
      <para>
	Currently Sauron homepage is located at:
	<ulink url="http://sauron.jyu.fi/">
	  <citetitle>http://sauron.jyu.fi/</>
	</ulink>
      </para>
    </section>

    <section>
      <title>Software Distribution Sites</>
      <para>
        Sauron can be downloaded from following sites:
        <simplelist type=vert columns=1>
	  <member>
	     <ulink url="http://sauron.jyu.fi/pub/sauron/">
              <citetitle>http://sauron.jyu.fi/pub/sauron/</>
             </ulink>
          </member>
	  <member>
	     <ulink url="ftp://ftp.jyu.fi/pub/sauron/">
              <citetitle>ftp://ftp.jyu.fi/pub/sauron/</>
             </ulink>
          </member>
        </simplelist>
      </para>
    </section>

    <section>
      <title>Mailing lists</>
      <para>
         <itemizedlist>
	  <listitem><para>
           <email>sauron-announce@lists.jyu.fi</> - new releace
           announcements and other ipmortant messages (moderated)
          </para></listitem>
	  <listitem><para>
           <email>sauron-users@lists.jyu.fi</> - general discussion
           and help forum
          </para></listitem>
	  <listitem><para>
           <email>sauron-devel@lists.jyu.fi</> - development and
           bug tracking
          </para></listitem>
         </itemizedlist>
      </para>
      <para>
	 To subscribe any of these mailing lists, send  an empty e-mail to 
         <foreignphrase>&lt;list-name&gt;</>-request@lists.jyu.fi
         address with subject line <quote>subscribe</> 
         (where &lt;list-name&gt; is the name of the list you want 
         to subscribe).
         <informalexample>
	  <para>
          For example, to subscribe <email>sauron-users@lists.jyu.fi</>
          you would need to send following empty e-mail:
          </para>
	  <screen>
           To: sauron-users-request@lists.jyu.fi
           Subject: subscribe
          </screen>
	 </informalexample>
      </para>
    </section>


    <section>
      <title>Acknowledgements</>
      <para>
	Special thanks for following people, who have been very
	helpful to the development of Sauron:
      </para>
      <para>
        <simplelist type=vert columns=1>
	 <member>Teemu Lähteenmäki <email>tola@iki.fi</></>
	 <member>Riku Meskanen <email>mesrik@iki.fi</></>
	 <member>Otto J. Mäkelä <email>om@iki.fi</></>
        </simplelist>
      </para>
    </section>

  </chapter>


  <chapter id="installation">
    <title>Installation</>
    <para>
    This chapter covers the general installation process for Sauron.
    This includes software installation and initial system configuration.
    Before installing sauron make sure you have all the required programs
    installed.
    </para>

    <section id="system-requirements">
      <title>System Requirements</>
      <para>
        Sauron is developed under Linux and Solaris, but is should work pretty
        much on any *nix like OS (as long as you can get the required programs
        on your platform). Sauron is currently written entirely in Perl (with
        some supporting shell-scripts).
      </para>

      <section>
        <title>Required Programs</>
        <para>
        Following programs are needed to run Sauron.
        <itemizedlist>
	  <listitem><para>
            PostgreSQL v7.x or later (7.2.3 or newer recommended)
          </para></listitem>
	  <listitem><para>
            Perl 5 or later (at least 5.6 recommended)
          </para></listitem>
          <listitem><para>
            Perl modules (these can be found from CPAN):
            <itemizedlist>
	      <listitem><para>CGI v2.752 or later 
                              (older versions should work fine too)</></>
	      <listitem><para>Digest::MD5 v2.20 or later</></>
	      <listitem><para>Net::Netmask v1.9002 or later</></>
	      <listitem><para>Pg v1.9.0 or later (PostgreSQL interface)</></>
	    </itemizedlist>
          </para></listitem>
	  <listitem><para>
            Apache or any other www server that supports CGI
            (for WWW interface)
          </para></listitem>
        </itemizedlist>
        </para>
      </section>

      <section>
        <title>Related Programs</>
        <para>
        To use DNS & DHCP configurations generated by Sauron you will 
        also need 
        <ulink url="http://www.isc.org/">
          <citetitle>Internet Software Consortium's</>
        </ulink> DNS & DHCP programs.

        <itemizedlist>
          <listitem><para>BIND 8.2.x or later 
           (9.2.x or newere recommended)</></>
	  <listitem><para>DHCP v2 or later 
           (3.x or newer strongly recommended)</></>
        </itemizedlist>
        </para>
      </section>

    </section>

    <section>
      <title>Installing Sauron</>
      <para>
        Sauron is currently available as a source <quote>tarball</> as well
        as a RPM package (RPM package is made for RedHat Linux systems).
        Decide which version you want to use to install Sauron from and
        and proceed to either <xref linkend="install-tgz"> or 
        <xref linkend="install-rpm">.
      </para>

      <section id="install-tgz">
        <title>Installing from the sources</title>
        <para>
        First step, when installing from the source archive
        is to unpack the tar file into a directory and change
        current directory to that directory. This can be
        done as follows:
        <screen>
        gunzip -c sauron-0.5.0.tar.gz | tar xvf -
        cd sauron-0.5.0
        </screen>
        </para>
        
        <para>
        Next step is to install Sauron from the sources. By default
        sauron program files will be installed under 
        <filename class=directory>/usr/local/sauron</>,
        and configuration files under 
        <filename class=directory>/usr/local/etc/sauron</>. If you
        want to install sauron under some other directories you need
        to specify 
        <parameter class=command>--prefix</> and
        <parameter class=command>--sysconfdir</> arguments when invoking 
        configure script. To install Sauron under default directories
        issue following commands:
        <screen>
        ./configure
        make
        make docs
        make install
        </screen>
        </para>

      </section>

      <section id="install-rpm">
        <title>Installing from the RPM</>
       <para>
       To install (or update) Sauron from RPM package you can simply
       istall the package as follows:
       <screen>
       rpm -Uvh sauron-0.5.0-1.noarch.rpm
       </screen>
       </para>
      </section>

    </section>

    <section>
      <title>Sauron Configuration</>
      <para>
      Sauron configuration settings are stored in <filename>config</>
      file, which is usually located in
      <filename class=directory>/usr/local/etc/sauron/</>
      or in <filename class=directory>/etc/sauron/</> (if Sauron
      is installed from RPM). This configuration file is parsed
      actually as a Perl code, so it is possible to set the configuration
      variables conditionally if desired.
      </para>
      <para>
      Configuration file contains common configuration settings for
      all Sauron components (except browser.cgi which uses it's own
      configuration file <filename>config-browser</>). Here we cover
      only the basic settings that you need to set before using Sauron.
      For more advanced settings, see the configuration file where 
      all the advanced configuration options are documented.

      <variablelist><title>General Configuration Options</>
	<varlistentry><term>DB_CONNECT</>
         <listitem><para>
           Database connection parameters string. This defines the database
           to connect to, and optionally database username and password
           to use. See <xref linkend="db-config-sec">
           how to setup a database for Sauron. 
         </para>
         <para>
           To setup connection to a database named <database>sauron</>
           in localhost, you might vant to set this variable to:
           <screen>
           "dbname=sauron user=foo password=bar"
           </screen>
           Or, if you're connecting to a database at remote computer:
           <screen>
           "host=remotehost port=5432 dbname=sauron user=foo password=bar"
           </screen>
         </para>
         <para>
           <table frame=all><title>Database Connection String Paramaters</>
             <tgroup cols=3 align=left colsep=1 rowsep=1>
             <colspec colname=c1>
             <colspec colname=c2>
             <colspec colname=c3>
	     <thead>
             <row>
              <entry>Parameter</>
              <entry>Default value</>
              <entry>Description</>
             </row>
             </thead>
             <tbody>
             <row>
              <entry>host</><entry>localhost</>
              <entry>Hostname of the database server.</>
             </row>
             <row>
              <entry>port</><entry>5432</>
              <entry>Port to connect on database server.</>
             </row>
             <row>
              <entry>dbname</><entry>current userid</>
              <entry>Database name to connect.</>
             </row>
             <row>
              <entry>user</><entry>current userid</>
              <entry>Database username.</>
             </row>
             <row>
              <entry>password</><entry></>
              <entry>Password.</>
             </row>
             </tbody>
             </tgroup>
           </table>
		     
         </para></listitem>
        </varlistentry>

	<varlistentry><term>PROG_DIR</>
         <listitem><para>
           Base directory for Sauron installation. This should be
           set to the directory where program files where installed.
           Usually this is either 
           <filename class=directory>/usr/local/sauron</> or
           <filename class=directory>/opt/sauron</> (if installed from RPM).
         </para></listitem>
        </varlistentry>

	<varlistentry><term>LOG_DIR</>
         <listitem><para>
           Directory for log files. Currently only the web interface
           (<filename>sauron.cgi</>) uses this directory to write to 
           <filename>sauron.log</> file in this directory. 
           Remember to make sure that the <filename>saurno.cgi</> has
           permissions to write into this file.
         </para></listitem>
        </varlistentry>

	<varlistentry><term>SERVER_ID</>
         <listitem><para>
           Unique identifier for this Sauron installation. This identifier
           is used by the web interface to generate unique cookies names,
           so you can access several different Sauron web interfaces 
           simulteneously from your browser. This identifier is also displayed
           by the web interface, to help you to identify which Sauron web
           interface you're currently connnected to. 
         </para></listitem>
        </varlistentry>

      </variablelist>
      </para>
    </section>

    <section id="db-config-sec">
      <title>Database Configuration</>
      <para>
      To use Sauron, you need to create a database for it in PostgreSQL.
      Unless you plan on restoring existing Sauron database from a database
      dump, you also need to setup necessary tables for Sauron to use.
      </para>

      <section>
      <title>Creating database for Sauron</>
      <para>
        Choose name for your database (for example: <filename>sauron</>)
        and create empty databse in PostgreSQL using <application>createdb</>
        program.
        <screen>
        createdb sauron
        </screen>
      </para>
      <para>
        After creating the database, you may either restore existing Sauron
        database dump or start from <quote>scratch</> and create necessary
        tables for Sauron as described in following Sections.
      </para>
      </section>

      <section>
      <title>Initializing Database</>
      <para>
        Before using sauron, you need to initialized the database. For this
        there is <application>createtables</> utility, that is included
        with Sauron. To initialize the database, simply run following command
        in Sauron program directory:
        <screen>
        ./createtables
        </screen>
        This command will create all the necessary tables needed by Sauron.
        You can check that everything worked by issuing the following command:
        <screen>
        ./status
        </screen>
        This should produce output similar to following showing that the
        database connection works:
        <screen>
Sauron v0.5.0 status

Database connection:   OK
Database version:      1.0
CGI interface:         Enabled
        </screen>
      </para>
      </section>

      <section>
      <title>Initializing Global Tables</>
      <para>
        Sauron has several global tables that contain data that is used
        by all servers stored in a Sauron database. These tables contain
        a table (<filename>ether_info</>) that contains mappings of
        <acronym>OUI</>'s to Manufacturers which is used to display
        the manufacturers of <acronym>NICs</> based on the
        <hardware>Ethernet</> <acronym>MAC</> address.
        There is also a table (<filename>root_servers</>) that contains
        global (default) root server information, and optionally also
        server specific root server information.
      </para>
 
      <para>
        To populate OUI (<filename>ether_info</>) table with the
        included files, issue following commands in the Sauron top-level
        directory:
        <screen>
        ./import-ethers contrib/Ethernet.txt
        ./import-ethers --force contrib/additional-ether-codes.txt
        </screen>
        You may also want to download <acronym>IEEE</>'s 
        up to date public list of OUIs from 
        <ulink url="http://standards.ieee.org/regauth/oui/index.shtml">
          <citetitle>IEEE's web site</></ulink>, and install it as follows:
        <screen>
        ./import-ethers oui.txt
        </screen>
      </para>
 
      <para>
        You should also add default root servers into <filename>root_servers</>
        table. This can be done as follows:
        <screen>
        ./import-roots default contrib/named.root
        </screen>
        NOTE! remember to check for newer version of this file at
        <ulink url="ftp://ftp.rs.internic.net/domain/">
          <citetitle>ftp.rs.internic.net</>
        </ulink>.
      </para>
      </section>

    </section>

    <section>
      <title>WWW Server Configuration</>
      <para>
        To be able to use Sauron's web interface you need to make
        <filename>sauron.cgi</> and <filename>browser.cgi</>
        (if you wan't to use the Sauron DNS browser) available through
        your www server. To do this you typically would either make symbolic
        links to these files or copy these files in your 
        <filename class=directory>cgi-bin</> directory. Note, if you're
        installing from the <acronym>RPM</> package, these symbolic links
        are created automatically, so you only need to check that your 
        web server configuration allow symlinks in your cgi-bin directory.

      </para> 
      <para>
          You should use your web server configuration and/or firewall
          to limit access to <filename>sauron.cgi</> and 
          <filename>browser.cgi</> cgi scripts only from the machines
          you need to access Sauron from.
      </para>

      <para>
         Sauron web interface uses several icons and images that are
         by default installed under the top-level sauron directory.
         You need to make these available through your web server
         via <filename class=directory>/sauron/icons/</> directory
         (unless you're installing from the RPM which does this automatically
         for you).
         To do this you can create that directory under your
         www server root and then either make symbolic links or copy
         all the image files from 
         <filename class=directory>&lt;sauron top-level directory&gt;/icons/</>
         into this directory.
      </para>
    </section>

  </chapter>

  
  <chapter id="getting-started">
    <title>Getting Started</>
    <para>
      FIXME
    </para>
  </chapter>


  <chapter id="reference">
    <title>Reference</>
    <para>
      FIXME
    </para>
  </chapter>

  <appendix id="command-ref">
    <title>Command Reference</>
    <para>
      FIXME
    </para>
  </appendix>

  <appendix id="tech-details">
    <title>Technical Details</>
    <para>
      FIXME
    </para>
    &sql-tables;
  </appendix>

  <appendix id="license">
    <title>Software License</>
    &gpl;
  </appendix>

</book>

